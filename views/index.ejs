<%
var page = 'home';
%>
<%- include includes/header.ejs %>
<%
if (!token) {
%>
The Gitlab token is not set up. Please have a Gitlab administrator log in to verify the application.
<%
}
%>
<%
if (projects.length == 0) {
%>
<h1>No Projects Found</h1>
<a href="/auth" class="btn btn-success">Relog</a>
<%
} else {
%>
<h1 class="page-header">Projects</h1>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>Project</th>
            <th>Date</th>
            <th>Builds</th>
            <th>Download</th>
        </tr>
        </thead>
        <tbody>
        <%
        projects.forEach(function (project) {
            var info = project.info;
            var latest = project.getLatestBuild();
            var id = latest.id.replace(/\\/g, '/').split('/').splice(2).join('/');
        %>
        <tr>
            <td><a href="<%= info.url %>"><%= info.name %></a></td>
            <td><%= new Date(latest.date).toUTCString() %></td>
            <td><%= info.builds.length %></td>
            <td class="btn-group">
                <a href="/downloads/<%= info.id %>/<%= info.builds.length - 1 %>/<%= id %>" class="btn btn-sm btn-info"><i class="fa fa-download"></i></a>
                <button type="button" class="btn btn-sm btn-info dropdown-toggle" data-toggle="dropdown">
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <%
                        info.builds = info.builds.sort(function (o1, o2) {
                            if (o1.date > o2.date) {
                                return 1;
                            } else if (o2.date > o1.date) {
                                return -1;
                            }
                            return 0;
                        });
                    for (var i = 0; i < info.builds.length; i++) {
                        id = info.builds[i].id.replace(/\\/g, '/').split('/').splice(2).join('/');
                    %>
                    <li>
                        <a href="/downloads/<%= info.id %>/<%= i %>/<%= id %>" value="<%= i %>" data-id="<%= id %>">
                            #<%= i + 1 %> <%= new Date(info.builds[i].date).toUTCString() %>
                        </a>
                    </li>
                    <%
                    }
                    %>
                </ul>
            </td>
        </tr>
        <%
        });
        %>
        </tbody>
    </table>
<%
}
%>
<%- include includes/footer.ejs %>
